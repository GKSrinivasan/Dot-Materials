function editorChanged(){objChangeFlag=!0}function ddlGetManageCommunicationTreeViewOnSelect(n){var t,i;if($("#txtEmailNotificationKey").show(),$("#editorRegion").show(),$("#subjectName").show(),t=n.sender.dataItem(n.node),t.IsTreeTop!=!0&&showSaveWarning(n,"objChangeFlag"))appEmailId=t.AppEmailId,$("#divddlUserGrp").show(),$("#dashboardEmailUserGrid").show(),$("#txtEmailNotificationKey")[0].value=t.EmailSubject,$("#txtEmailNotificationKey").attr("readonly","true"),i=$("#emailnotificationEditor").data("kendoEditor"),i.body.contentEditable=!1,$(".k-editor-toolbar").hide(),$("#emailnotificationEditor").data("kendoEditor").value(t.EmailBody);else return appEmailTemplateID=0,appEmailTemplateKey="",$("#divddlUserGrp").hide(),n._defaultPrevented=!0,!1}function ddlGetManagerTemplateTreeViewOnSelect(n){var t=n.sender.dataItem(n.node);if(t.IsTreeTop!=!0&&showSaveWarning(n,"objChangeFlag"))managerTemplateId=t.AppEmailId,$("#txtTemplateEmail").val(t.EmailSubject),$("#managerTemplateEditor").data("kendoEditor").value(t.EmailBody),$(".k-in").addClass("k-state-selected"),t.ParentMenuNum==555555?$("#btnManagerTemplateDelete").hide():$("#btnManagerTemplateDelete").show();else return n._defaultPrevented=!0,!1}function appendManageCommunicationChildNode(n,t,i,r){var u=n.filter(function(n){if(n[i]==r[t])return n});return $(u).each(function(r,u){appendManageCommunicationChildNode(n,t,i,u)}),u.length>0&&(r.EmailParent=u),r}function appendManagerTemplateChildNode(n,t,i,r){var u=n.filter(function(n){if(n[i]==r[t])return n});return $(u).each(function(r,u){appendManageCommunicationChildNode(n,t,i,u)}),u.length>0&&(r.EmailParent=u),r}function getManageCommunicationTreeViewDataSource(n,t,i,r){var u=[];return n.length>0&&$(n).each(function(f,e){if(e[r]==!0)u.push(appendManageCommunicationChildNode(n,t,i,e));else return!1}),new kendo.data.HierarchicalDataSource({data:u,schema:{model:{id:t,children:"EmailParent"}}})}function getManagerTemplateTreeViewDataSource(n,t,i,r){var u=[];return n.length>0&&$(n).each(function(f,e){if(e[r]==!0)u.push(appendManagerTemplateChildNode(n,t,i,e));else return!1}),new kendo.data.HierarchicalDataSource({data:u,schema:{model:{id:t,children:"EmailParent"}}})}function BindManageCommunicationTemplateTreeView(){var n=$('input[name="__RequestVerificationToken"]').val();$.post("../Communication/BindManageCommunicationTemplateTreeView",{__RequestVerificationToken:n},function(n){var i=getManagerTemplateTreeViewDataSource(n,"AppEmailId","ParentMenuNum","IsTreeTop"),r=$("#ddlbtnManagerTemplateTree").kendoExtDropDownTreeView({treeview:{template:"#=item.EmailSubject#",dataTextField:"EmailSubject",dataValueField:"AppEmailId",loadOnDemand:!1,dataSource:i,select:ddlGetManagerTemplateTreeViewOnSelect}}).data("kendoExtDropDownTreeView"),t;r._treeview.expand(".k-item");t="-Select-";$("#ddlbtnManagerTemplateTree").find(".k-input").text(t)})}function getEmailBody(){var n=$("#editor").data("kendoEditor");return n.value()}function GetParamValue(){var n=$("#hndselectedtype").val(),t=$("#hndvalue").val(),i=$('input[name="__RequestVerificationToken"]').val();return{__RequestVerificationToken:i,checkRole:n==1?"true":"false",userRoleNum:t}}function emailNotificationExport(){var t=appEmailId,i=$('input[name="__RequestVerificationToken"]').val(),n=$("<form action='../Communication/GetEmailNotificationExportData' method='post'><\/form>");n.append("<input type='text' name='__RequestVerificationToken' value='"+i+"' />");n.append("<input type='text' name='appEmailID' value='"+t+"' />");n.appendTo("body");n.submit();n.remove()}function BindManageCommunicationTreeView(){var n=$('input[name="__RequestVerificationToken"]').val();$.post("../Communication/BindManageCommunicationTreeView",{__RequestVerificationToken:n},function(n){var i=getManageCommunicationTreeViewDataSource(n,"AppEmailId","ParentMenuNum","IsTreeTop"),r=$("#ddlMessageCommunicationTemplateTree").kendoExtDropDownTreeView({treeview:{template:"#=item.EmailSubject#",dataTextField:"EmailSubject",dataValueField:"AppEmailId",loadOnDemand:!1,dataSource:i,select:ddlGetManageCommunicationTreeViewOnSelect}}).data("kendoExtDropDownTreeView"),t;r._treeview.expand(".k-item");t="-Select-";$("#ddlMessageCommunicationTemplateTree").find(".k-input").text(t)})}function BindEmailNotificationTreeview(){var n=$('input[name="__RequestVerificationToken"]').val();$.post("../Communication/_SendEmailNotificationTree",{__RequestVerificationToken:n},function(n){var r=getEmailNotificationHierarchialDataSource(n,"UserRoleNum","ReportingManagerNum","IsTreeTop"),i=$("#ddlEmailNotificationTreeview").kendoExtDropDownTreeView({treeview:{template:"#= item.UserRoleName#",dataTextField:"UserRoleName",dataValueField:"UserRoleNum",loadOnDemand:!0,dataSource:r,select:BindEmailNotificationTreeviewOnSelect}}).data("kendoExtDropDownTreeView"),t;i._treeview.expand(".k-item");t="";t="-Select- ";i.bind("select",function(n){if($("#hndIsNodeSelected").val()==1)$("#ddlEmailNotificationTreeview").find(".k-input").text($("#hndSelectedTreeText").val());else{var t=$(n.node).children("div").text();$("#ddlEmailNotificationTreeview").find(".k-input").text(t)}});$("#ddlEmailNotificationTreeview").find(".k-input").text(t)})}function getEmailNotificationHierarchialDataSource(n,t,i,r){var u=[];return n.length>0&&$(n).each(function(f,e){if(e[r]==!0)u.push(appendChildNode(n,t,i,e));else return!1}),new kendo.data.HierarchicalDataSource({data:u,schema:{model:{id:t,children:"ReporteeManagers"}}})}function appendChildNode(n,t,i,r){var u=n.filter(function(n){if(n[i]==r[t])return n});return $(u).each(function(r,u){appendChildNode(n,t,i,u)}),u.length>0&&(r.ReporteeManagers=u),r}function BindEmailNotificationTreeviewOnSelect(n){var t=n.sender.dataItem(n.node),u=n.sender,i,r;if($("#hndIsNodeSelected").val(t.UserRoleNum),$("#hndvalue").val(t.UserRoleNum),$("#hndtext").val(t.UserRoleName),$("#hndselectedtype").val(t.SelectedType),i=$("#dashboardEmailUserGrid").data("kendoGrid"),i.dataSource.read(),r=$(".k-item"),t.IsTreeTop!=!0&&showSaveWarning)$("#hndIsNodeSelected").val(0);else return u.select(r),$("#hndIsNodeSelected").val(1),n._defaultPrevented=!0,!1}function dashboardMessagesExport(){var t=$("#ddlDashboardMessage").data("kendoDropDownList")._selectedValue,i=t,r=$('input[name="__RequestVerificationToken"]').val(),n=$("<form action='../Communication/GetDashboardMessageExportData' method='post'><\/form>");n.append("<input type='text' name='__RequestVerificationToken' value='"+r+"' />");n.append("<input type='text' name='appMessageId' value='"+i+"' />");n.appendTo("body");n.submit();n.remove()}function BindDashboardMessageSearchCriteriaTreeView(){var n=$('input[name="__RequestVerificationToken"]').val();$.post("../Communication/SendDashboardMessageSearchCriteriaTree",{__RequestVerificationToken:n},function(n){var r=getDashboardMessageTreeViewDataSource(n,"UserRoleNum","ReportingManagerNum","IsTreeTop"),i=$("#ddlDashboardMessageTreeView").kendoExtDropDownTreeView({treeview:{template:"#= item.UserRoleName#",dataTextField:"UserRoleName",dataValueField:"UserRoleNum",loadOnDemand:!0,dataSource:r,select:ddlDashboardMessageTreeViewOnSelect}}).data("kendoExtDropDownTreeView"),t;i._treeview.expand(".k-item");t="";t="-Select- ";i.bind("select",function(n){if($("#hndIsNodeSelected").val()==1)$("#ddlDashboardMessageTreeView").find(".k-input").text($("#hndSelectedTreeText").val());else{var t=$(n.node).children("div").text();$("#ddlDashboardMessageTreeView").find(".k-input").text(t)}});$("#ddlDashboardMessageTreeView").find(".k-input").text(t)})}function getDashboardMessageTreeViewDataSource(n,t,i,r){var u=[];return n.length>0&&$(n).each(function(f,e){if(e[r]==!0)u.push(appendChildNode(n,t,i,e));else return!1}),new kendo.data.HierarchicalDataSource({data:u,schema:{model:{id:t,children:"ReporteeManagers"}}})}var managerTemplateId=0,objChangeFlag=!1,isFilter;$(document).on("click","#dashboardmsg",function(n){if(showSaveWarning(n,"objChangeFlag"))managerTemplateId=0,$("#mainemptydiv").show(),$.ajax({url:"../Communication/DashboardMessage",data:null,type:"get",cache:!1,success:function(n){$("#divDataBind").html(n)}});else return n._defaultPrevented=!0,!1});$(document).on("click",".noemptydiv",function(){$("#mainemptydiv").hide()});$(document).ready(function(){$("#lnkCommunicationTemplate").trigger("click");$("#mainemptydiv").hide();$("#btnClearFilter").hide();$("#divddlUserGrp").hide();$("#dashboardEmailUserGrid").hide();$("#btnCommunicationClear").hide();$("#yetToLoginUserList").hide();$("div.bhoechie-tab-menu>div.list-group>a").click(function(n){if(!showSaveWarning(n,"objChangeFlag"))return n._defaultPrevented=!0,!1;n.preventDefault();$(this).siblings("a.active").removeClass("active");$(this).addClass("active");var t=$(this).index();$("div.bhoechie-tab>div.bhoechie-tab-content").removeClass("active");$("div.bhoechie-tab>div.bhoechie-tab-content").eq(t).addClass("active");objChangeFlag=!1})});var appEmailTemplateID=0,appEmailTemplateKey="",appMessageId=0;$("#btnMessageCommunicationSave").on("click",function(){for(var r,e,o,u=$("#ddlMessageCommunicationTemplateTree").data("kendoExtDropDownTreeView")._treeview.dataSource.data(),n=$("#txtEmailKey")[0].value,t=getEmailBody(),f=[],s=$('input[name="__RequestVerificationToken"]').val(),i=0;i<u.length;i++)for(r=0;r<u[i].EmailParent.length;r++)f.push(u[i].EmailParent[r].EmailSubject.toLowerCase().trim());if(n==""&&t=="")return alert("Please provide email Subject and Body"),!1;if(n==""&&t!="")return alert("Please provide email Subject"),!1;if(t==""&&n!="")return alert("Please provide email Body"),!1;if(action=appEmailId==0?"Save":"Update",e=n.toLowerCase(),o=$.inArray(e,f),o>-1&&appEmailId==0)return Successmessage("Email Subject already exists,Error"),!1;$.ajax({url:"../Communication/SaveAndDeleteCommunicationEmail",cache:!1,type:"POST",data:JSON.stringify({__RequestVerificationToken:s,EmailSubject:n,EmailBody:t,AppEmailID:appEmailId}),dataType:"html",contentType:"application/json; charset=utf-8",success:function(n){objChangeFlag=!1;$("#renderCommunicationTemplate").html(n);action=="Save"?Successmessage("Email Template Saved Successfully,Success"):Successmessage("Email Template Updated Successfully,Success")}})});$("#chkBoxSelectAll").on("click",function(){this.checked?$("#checkBx input[type=checkbox]").each(function(){this.checked=!0}):$("#checkBx input[type=checkbox]").each(function(){this.checked=!1})});$(document).on("change","#txtTemplateEmail",function(){objChangeFlag=!0});$(document).on("click","#btnManagerTemplateDelete",function(n){if(managerTemplateId==0)return!1;if(showConfirm(n,"Are you sure to delete?")){var t=$('input[name="__RequestVerificationToken"]').val();$.ajax({url:"../Communication/_ManagerCommunicationTemplate",data:{__RequestVerificationToken:t,AppEmailID:managerTemplateId},type:"POST",success:function(n){objChangeFlag=!1;$("#rendermanagertemplatetree").html(n);$("#txtTemplateEmail").val("");var t=$("#managerTemplateEditor").data("kendoEditor");t.value("");$("#ddlbtnManagerTemplateTree").find(".k-input").text("-Select-");Successmessage("Email Template Deleted Successfully");managerTemplateId=0}})}else return!1});$(document).on("click","#btnManagerTemplateSave",function(){var r=$("#ddlbtnManagerTemplateTree").data("kendoExtDropDownTreeView")._treeview.dataSource.data(),n=$("#txtTemplateEmail")[0].value,t=$("#managerTemplateEditor")[0].value,i=$('input[name="__RequestVerificationToken"]').val();if(n==""&&t=="")return alert("Please provide email Subject and Body"),!1;if(n==""&&t!="")return alert("Please provide email Subject"),!1;if(t==""&&n!="")return alert("Please provide email Body"),!1;if(n.length>500)alert("The Email Subject Range should not exceed 500 characters");else{if(action=managerTemplateId==0?"Save":"Update",objChangeFlag==!1)return!1;$.ajax({url:"../Communication/_ManagerCommunicationTemplate",type:"POST",data:{__RequestVerificationToken:i,EmailSubject:n,EmailBody:t,AppEmailID:managerTemplateId},success:function(n){$("#rendermanagertemplatetree").html(n);objChangeFlag=!1;action=="Save"?Successmessage("Email Template Saved Successfully"):Successmessage("Email Template updated Successfully")}})}});$(document).on("click","#btnDashboardDelete",function(n){var t=$("#ddlDashboardMessage").data("kendoDropDownList")._selectedValue,i;if(t=="")return!1;if(showConfirm(n,"Are you sure to delete?"))i=$('input[name="__RequestVerificationToken"]').val(),$.ajax({url:"../Communication/DeleteDashboardMessage",type:"Post",cache:!1,data:{__RequestVerificationToken:i,AppMessageID:t,messageId:$("#ddlDashboardMessage").data("kendoDropDownList")._selectedValue},type:"POST",async:"true",success:function(){$("#ddlDashboardMessage").data("kendoDropDownList").value(0);$("#ddlDashboardMessage").data("kendoDropDownList").dataSource.read();$("#ddlDashboardMessage").data("kendoDropDownList").text("-Configured email list-");$("#dashboardSubject")[0].value=" ";$("#dashBoardMessageEditor").data("kendoEditor").value("");Successmessage("Message Template Deleted Successfully,Success");$("#yetToLoginUserList").hide();$("#hideUserGrid").hide()}});else return!1});$("#checkkBoxSelectAll").on("click",function(){this.checked?$("#chkBox input[type=checkbox]").each(function(){this.checked=!0}):$("#chkBox input[type=checkbox]").each(function(){this.checked=!1})});isFilter=!1;$(document).on("click","#lnkCommunicationTemplate",function(n){if(showSaveWarning(n,"objChangeFlag"))$.ajax({url:"../Communication/_ManagerCommunicationTemplate",data:null,type:"get",cache:!1,success:function(n){$("#divDataBind").html(n)}});else return n._defaultPrevented=!0,!1});$(document).on("click","#lnkEmailCommunication",function(n){if(showSaveWarning(n,"objChangeFlag"))managerTemplateId=0,$.ajax({url:"../Communication/EmailCommunication",data:null,type:"get",cache:!1,success:function(n){$("#divDataBind").html(n)}});else return n._defaultPrevented=!0,!1});$(document).on("click","#btnClearFilter",function(){clearFilterSort(!0);$("#btnClearFilter").hide();$("#filter").show()});$(document).on("click","#btnDashboardMessageFilter",function(){$("body").css("overflow","hidden");$.ajax({url:"../Communication/_DashboardMessageFilterSort",type:"GET",cache:!1,async:!0,dataType:"html",success:function(n){$("#communicationFilter").html(n);var t=$("#communicationFilter").data("kendoWindow");t.options.gridName="dashboardMessageUserGrid";t.center().open();isFilter=!0}})});$(document).on("click","#filter",function(){$("body").css("overflow","hidden");$.ajax({url:"../Communication/_EmailNotificationFilterSort",type:"GET",cache:!1,async:!0,dataType:"html",success:function(n){$("#emailcommunicationFilter").html(n);var t=$("#emailcommunicationFilter").data("kendoWindow");t.options.gridName="dashboardEmailUserGrid";t.center().open();isFilter=!0}})});$(document).on("click","#btnCommunicationClear",function(){clearFilterSort(!0);$("#btnCommunicationClear").hide();$("#btnDashboardMessageFilter").show()});